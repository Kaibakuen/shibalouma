<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢é€” AI æ—…ä¼´ </title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        :root { font-family: 'Inter', sans-serif; }
        /* æ¨¡æ“¬ LINE èŠå¤©èƒŒæ™¯ */
        body { background-color: #f0f0f0; }
        #chat-window {
            background-color: #e5ddd5; /* è¼•å¾®çš„ç±³ç™½è‰²èƒŒæ™¯ */
            max-width: 480px;
            height: 90vh; /* å¢åŠ é«˜åº¦ */
            max-height: 800px;
            margin: 20px auto;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .bot-message {
            background-color: #ffffff;
            border-radius: 15px 15px 15px 5px;
            max-width: 85%; /* å¢åŠ å¯¬åº¦ä»¥å®¹ç´å¡ç‰‡ */
        }
        .user-message {
            background-color: #a8e48b; /* LINE ç¶  */
            border-radius: 15px 15px 5px 15px;
            max-width: 80%;
        }
        .flex-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
            border: 1px solid #ddd;
        }
        /* è®“ Lucide Icon æ¸²æŸ“ */
        [data-lucide] { display: inline-block; }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen">

    <div id="chat-window">
        <!-- Chat Header -->
        <div class="p-4 bg-green-700 text-white shadow-md flex items-center justify-center rounded-t-xl">
            <i data-lucide="map-pin" class="w-5 h-5 mr-2"></i>
            <h1 class="text-xl font-bold">å®¢é€” AI æ—…ä¼´ - æµªæ¼«å°ä¸‰ç·š</h1>
        </div>

        <!-- Messages Container -->
        <div id="messages" class="flex-1 p-4 overflow-y-auto space-y-4">
            <!-- Initial Message Placeholder -->
        </div>

        <!-- Input Area (Rich Menu & Text Input Simulation) -->
        <div id="input-area" class="p-4 bg-gray-100 border-t border-gray-300">
            <div id="rich-menu-sim" class="flex justify-center space-x-2 mb-3">
                <button onclick="handleMessage('æˆ‘æƒ³è¦åŠƒè¡Œç¨‹')" class="bg-indigo-500 hover:bg-indigo-600 text-white text-xs px-3 py-1 rounded-full shadow-md transition duration-200">
                    <i data-lucide="route" class="w-3 h-3 inline-block"></i> ç›´æ¥è¦åŠƒ
                </button>
                <button onclick="handleMessage('é‡æ–°æ¸¬é©—')" class="bg-green-600 hover:bg-green-700 text-white text-xs px-3 py-1 rounded-full shadow-md transition duration-200">
                    <i data-lucide="list-checks" class="w-3 h-3 inline-block"></i> é–‹å§‹æ¸¬é©—
                </button>
            </div>
            <div class="flex">
                <input type="text" id="user-input" placeholder="ä¾‹å¦‚ï¼šæ–°ç«¹å³¨çœ‰ï¼Œæˆ¶å¤–æ´»å‹•" class="flex-1 p-2 border border-gray-300 rounded-l-lg focus:outline-none" onkeyup="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-green-500 hover:bg-green-600 text-white px-4 rounded-r-lg shadow-md transition duration-200">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒæ•¸æ“šçµæ§‹ (ç”¨æ–¼å„²å­˜ç”¨æˆ¶ç‹€æ…‹èˆ‡åå¥½å‘é‡) ---

        const USER_STATUS_DB = {};
        const DEFAULT_USER_ID = "web_user_123";
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('user-input');

        // æ—…éŠåå¥½ç¶­åº¦
        const PREFERENCE_DIMENSIONS = {
            "Culture": 0, "Outdoor": 0, "Pace": 0, "LowCarbon": 0,
            "Family": 0, "Accessibility": 0, "CultureDepth": 0,
            "Indoor": 0, "RiskAversion": 0
        };

        // å°ä¸‰ç·šæ™¯é»è³‡æ–™åº« (çœŸå¯¦æ™¯é»ï¼Œæ¨¡æ“¬ Google Maps é€£çµ)
        const HAKKA_ATTRACTIONS = [
            { id: 1, region: "æ¡ƒåœ’", name: "å¤§æºªè€è¡— (Daxi Old Street)", theme: ["Culture", "Indoor", "Pace"], description: "å……æ»¿å·´æ´›å…‹å¼ç«‹é¢å»ºç¯‰çš„æ­·å²è¡—å€ï¼Œé©åˆå®¤å…§æ–‡åŒ–æ¢ç´¢èˆ‡æ…¢æ­¥èª¿ã€‚", map_url: "https://maps.app.goo.gl/yQ9fQ7k7yJ6eLg9v9" },
            { id: 2, region: "æ–°ç«¹", name: "åŒ—åŸ”è€è¡—/é‡‘å»£ç¦å…¬é¤¨", theme: ["Culture", "CultureDepth", "Indoor"], description: "åŒ—å°ç£å®¢å®¶æ–‡åŒ–çš„ä¸­å¿ƒï¼Œå¿…åšæ“‚èŒ¶ï¼Œé©åˆæ–‡å²æ„›å¥½è€…æ·±åº¦æ¢ç´¢ã€‚", map_url: "https://maps.app.goo.gl/6E6oN2hV1r9XJz3f7" },
            { id: 3, region: "æ–°ç«¹", name: "å³¨çœ‰æ¹–/ç´°èŒ…åŸ”åŠæ©‹", theme: ["Outdoor", "LowCarbon", "Pace"], description: "æ¹–ç•”æ­¥é“èˆ‡ç”Ÿæ…‹æ™¯è§€ï¼Œé©åˆæˆ¶å¤–ã€é¨å–®è»Šçš„ä½ç¢³æ…¢æ´»è·¯ç·šã€‚", map_url: "https://maps.app.goo.gl/DkK8Z7yB7N8xT6rD7" },
            { id: 4, region: "è‹—æ —", name: "ç…é ­å±±é¢¨æ™¯å€", theme: ["Outdoor", "CultureDepth", "RiskAversion"], description: "å¥è¡Œæ­¥é“èˆ‡å¤é“æ–‡åŒ–ï¼Œæ˜¯æŒ‘æˆ°å‹çš„æˆ¶å¤–ç™»å±±å¥è¡Œé¦–é¸ã€‚", map_url: "https://maps.app.goo.gl/yP7jXg4Z1b6hC5rP9" },
            { id: 5, region: "è‹—æ —", name: "å—åº„è€è¡— (æ¡‚èŠ±å··)", theme: ["Culture", "Indoor", "Family"], description: "è¼•é¬†é€›è¡—ã€å“åšå®¢å®¶å°åƒï¼Œå…·å‚™è¦ªå­å‹å–„è¨­æ–½ã€‚", map_url: "https://maps.app.goo.gl/wU2aD6yZ9k7qL5xK8" },
            { id: 6, region: "å°ä¸­", name: "æ±å‹¢å®¢å®¶æ–‡åŒ–åœ’å€ (è‡ªè¡Œè»Šé“)", theme: ["LowCarbon", "Outdoor", "Pace"], description: "èˆŠç«è»Šç«™æ”¹å»ºï¼Œçµåˆéµé“æ–‡åŒ–èˆ‡ç¶ è‰²å»Šé“ï¼Œæ˜¯å–®è»Šæ´»å‹•çš„æœ€ä½³èµ·é»ã€‚", map_url: "https://maps.app.goo.gl/Gj8xN4bY5rE2pA3c6" }
        ];

        // 10 é¡Œéš±æ™¦å¼äººæ ¼æ¸¬é©—é¡Œç›®åŠå…¶å‘é‡æ¬Šé‡ (ä¸è®Š)
        const QUIZ_QUESTIONS = {
            1: {
                "text": "Q1: æ—…éŠçµæŸæ™‚ï¼Œæ‚¨æœ€æƒ³å¸¶å›å®¶çš„ç´€å¿µå“æ˜¯ä»€éº¼ï¼Ÿ",
                "options": [
                    { label: "A: å®¢åº„è€åº—çš„æ‰‹å·¥è—å“æˆ–é™¶ç“·", val: "+3Culture,+2CultureDepth,+1Pace" },
                    { label: "B: æ²¿é€”é¢¨æ™¯æ‹ä¸‹çš„å°ˆæ¥­ç…§ç‰‡", val: "+3Outdoor,-1CultureDepth,-1Pace" },
                    { label: "C: ç•¶åœ°ç‰¹æœ‰çš„ç¾å‘³é›¶é£Ÿæˆ–ç‰¹ç”¢", val: "+2Pace,+1Indoor,-1Culture" },
                ]
            },
            2: {
                "text": "Q2: æ‚¨çš„æ‰‹æ©Ÿè£¡ï¼Œå“ªé¡Appæœ€å¸¸ç”¨ï¼Ÿ",
                "options": [
                    { label: "A: é–±è®€æ–°èã€é›»å­æ›¸æˆ–çŸ¥è­˜å‹App", val: "+3CultureDepth,+1Culture,+1Pace" },
                    { label: "B: é‹å‹•è¿½è¹¤ã€åœ°åœ–å°èˆªæˆ–å¤©æ°£é å ±", val: "+3Outdoor,+2RiskAversion,-1Indoor" },
                    { label: "C: ç¤¾äº¤åª’é«”ã€ç¾é£Ÿè©•è«–æˆ–è³¼ç‰©App", val: "+2Pace,-1CultureDepth,+1Indoor" },
                ]
            },
            3: {
                "text": "Q3: åœ¨ä¸€å€‹é€±æœ«ï¼Œæ‚¨æœƒå¦‚ä½•å®‰æ’æ‚¨çš„æ™‚é–“ï¼Ÿ",
                "options": [
                    { label: "A: å¯†é›†å®‰æ’å¤šé …æ´»å‹•ï¼ŒæŠŠæ™‚é–“å¡«æ»¿", val: "-3Pace,-2RiskAversion" },
                    { label: "B: å½ˆæ€§å®‰æ’ï¼Œç•™æœ‰å¤§é‡ç©ºç™½æ™‚é–“ä¼‘æ¯", val: "+3Pace,+2RiskAversion" },
                ]
            },
            4: {
                "text": "Q4: æ‚¨çš„ç†æƒ³ä½æ‰€æ˜¯ä»€éº¼æ¨£çš„ï¼Ÿ",
                "options": [
                    { label: "A: é è¿‘å…¬åœ’æˆ–å±±å€ï¼Œé™½å…‰å……è¶³çš„éƒŠå€æˆ¿", val: "+3Outdoor,+2LowCarbon" },
                    { label: "B: å¸‚ä¸­å¿ƒï¼Œç”Ÿæ´»æ©Ÿèƒ½æ–¹ä¾¿çš„é«˜æ¨“å±¤å…¬å¯“", val: "-3LowCarbon,-2Outdoor,+2Indoor" },
                    { label: "C: å……æ»¿æ­·å²æ„Ÿï¼Œè£æ½¢ç°¡æ¨¸çš„è€å¼å¹³æˆ¿", val: "+3Culture,+1CultureDepth,+1Pace" },
                ]
            },
            5: {
                "text": "Q5: è¦åŠƒè¡Œç¨‹æ™‚ï¼Œæ‚¨æœƒå…ˆè€ƒé‡ä»€éº¼ï¼Ÿ",
                "options": [
                    { label: "A: é¤å»³æˆ–æ´»å‹•æ˜¯å¦æœ‰å…’ç«¥æˆ–é•·è€…å‹å–„è¨­æ–½", val: "+4Family,+4Accessibility" },
                    { label: "B: äº¤é€šæ¥é§æ˜¯å¦æ–¹ä¾¿ï¼Œæ˜¯å¦æœƒæµªè²»æ™‚é–“", val: "-3LowCarbon,-2Pace" },
                    { label: "C: è©²åœ°é»çš„æ­·å²è©•åƒ¹å’Œç¨ç‰¹æ€§", val: "+3Culture,+1CultureDepth" },
                ]
            },
            6: {
                "text": "Q6: æ—…é€”ä¸­é‡åˆ°çªç™¼ç‹€æ³ï¼Œæ‚¨å‚¾å‘ï¼Ÿ",
                "options": [
                    { label: "A: å …æŒæŒ‰åŸè¨ˆç•«èµ°ï¼Œç›¸ä¿¡å•é¡Œæœƒè§£æ±º", val: "-3RiskAversion" },
                    { label: "B: ç«‹å³å•Ÿå‹•å‚™ç”¨æ–¹æ¡ˆï¼Œé¿å…ä»»ä½•é¢¨éšª", val: "+3RiskAversion,+2Indoor" },
                    { label: "C: è©¢å•ç•¶åœ°äººï¼Œéš¨æ©Ÿæ‡‰è®Šæ‰¾åˆ°æ–°æ¨‚è¶£", val: "+2Outdoor,-1RiskAversion" },
                ]
            },
            7: {
                "text": "Q7: æ‚¨å°æ–°çŸ¥è­˜çš„ç²å–æ–¹å¼æ˜¯ï¼Ÿ",
                "options": [
                    { label: "A: å–œæ­¡é–±è®€æ·±åº¦è³‡æ–™ã€æ›¸ç±æˆ–ç´€éŒ„ç‰‡", val: "+3CultureDepth,+2Culture" },
                    { label: "B: å¿«é€Ÿç€è¦½æ‘˜è¦ã€çœ‹å½±ç‰‡ç²¾è¯", val: "-2CultureDepth,-1Pace" },
                ]
            },
            8: {
                "text": "Q8: å¾’æ­¥æˆ–é¨å–®è»Šï¼Œæ‚¨æ›´å–œæ­¡ï¼Ÿ",
                "options": [
                    { label: "A: å¾’æ­¥ï¼Œèƒ½ç·©æ…¢æ„Ÿå—å‘¨é­ä¸€åˆ‡", val: "+3Pace,+2Outdoor,+2LowCarbon" },
                    { label: "B: é¨å–®è»Šï¼Œèƒ½æ›´å¿«åˆ°é”æ›´å¤šåœ°æ–¹", val: "-2Pace,+3Outdoor,+2LowCarbon" },
                ]
            },
            9: {
                "text": "Q9: å“ªç¨®å®¢åº„é«”é©—å°æ‚¨æ›´æœ‰å¸å¼•åŠ›ï¼Ÿ",
                "options": [
                    { label: "A: åœ¨å®¢å®¶å»šæˆ¿å­¸åšç±³é£Ÿï¼Œäº«å—å®¤å…§æ™‚å…‰", val: "+3Indoor,+2Culture" },
                    { label: "B: æ¡èŒ¶æˆ–è¾²å ´é«”é©—ï¼Œè¦ªæ‰‹æ¥è§¸åœŸåœ°", val: "+3Outdoor,+1LowCarbon" },
                    { label: "C: åƒè§€å®¢å®¶å®—ç¥ ï¼Œè½å®—æ—é·å¾™å²", val: "+3CultureDepth,+3Culture" },
                ]
            },
            10: {
                "text": "Q10: æ‚¨çš„è¡Œæç®±é€šå¸¸æ˜¯ä»€éº¼ç‹€æ…‹ï¼Ÿ",
                "options": [
                    { label: "A: ç²¾ç°¡è¼•ä¾¿ï¼Œåªå¸¶å¿…éœ€å“", val: "-3RiskAversion,-1Indoor" },
                    { label: "B: äº•ç„¶æœ‰åºï¼Œå„ç¨®å‚™ç”¨ç‰©å“ä¿±å…¨", val: "+3RiskAversion,+1Indoor" },
                    { label: "C: è£æ»¿æˆ¶å¤–è£å‚™å’Œèˆ’é©çš„è¡£ç‰©", val: "+3Outdoor" },
                ]
            },
        };
        const TOTAL_QUIZ_STEPS = Object.keys(QUIZ_QUESTIONS).length; // ç¸½å…±æœ‰ 10 é¡Œ

        // --- æ ¸å¿ƒé‚è¼¯å‡½æ•¸ ---

        function getUserState(userId) {
            if (!USER_STATUS_DB[userId]) {
                USER_STATUS_DB[userId] = {
                    "quiz_step": 0,
                    "preferences": { ...PREFERENCE_DIMENSIONS }
                };
            }
            return USER_STATUS_DB[userId];
        }

        /**
         * æ ¹æ“šæ¸¬é©—é¸é …æ›´æ–°ç”¨æˆ¶çš„æ—…éŠåå¥½å‘é‡ã€‚
         * @param {string} userId - ç”¨æˆ¶ IDã€‚
         * @param {string | null} valString - åŒ…å«æ¬Šé‡åˆ†æ•¸çš„å­—ä¸²ï¼Œä¾‹å¦‚ "+3Culture,+2CultureDepth"ã€‚
         */
        function updatePreferenceVector(userId, valString) {
            const state = getUserState(userId);
            
            (valString || "").split(',').forEach(item => { 
                if (!item) return;
                
                const matches = item.match(/([+-]\d+)([A-Za-z]+)/);
                if (matches && matches.length === 3) {
                    const val = parseInt(matches[1]);
                    const dim = matches[2];
                    
                    if (dim in state.preferences) {
                        state.preferences[dim] += val;
                    }
                }
            });
            return state.preferences;
        }

        // --- è¨Šæ¯ UI å‡½æ•¸ ---

        function addMessage(type, contentHTML, isQuiz = false) {
            const isBot = (type === 'bot' || type === 'quiz');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isBot ? 'justify-start' : 'justify-end'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `p-3 ${isBot ? 'bot-message' : 'user-message'}`;

            if (isQuiz) {
                // æ¸¬é©—è¨Šæ¯ä½¿ç”¨ç‰¹æ®Šçš„å¡ç‰‡æ¨£å¼
                contentDiv.classList.add('flex-card', 'bg-white', 'p-4', 'shadow-lg', 'text-gray-800');
            } 

            if (isBot && !isQuiz) {
                // ä¸€èˆ¬æ©Ÿå™¨äººè¨Šæ¯
                contentDiv.innerHTML = `<i data-lucide="bot" class="w-4 h-4 mr-1 inline-block text-green-700"></i> ${contentHTML}`;
            } else if (!isBot) {
                // ç”¨æˆ¶è¨Šæ¯
                contentDiv.innerHTML = contentHTML;
            } else if (isQuiz) {
                // æ¸¬é©—è¨Šæ¯ï¼Œå…§å®¹å·²åœ¨ createQuizMessage ä¸­çµæ§‹åŒ–
                contentDiv.innerHTML = contentHTML;
            }

            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            lucide.createIcons();
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return messageDiv.querySelector('div:last-child'); // Return the actual message content div
        }

        // --- æ¸¬é©— UI å‡½æ•¸ ---

        function createQuizMessage(questionData, currentStep) {
            const q = questionData.text;
            const options = questionData.options;
            
            let quizHTML = `
                <div class="text-xs text-gray-500 mb-2">å®¢é€” AI æ—…ä¼´ - æ—…éŠåå¥½å•å· (ç¬¬ ${currentStep}/${TOTAL_QUIZ_STEPS} é¡Œ)</div>
                <div class="text-lg font-bold text-green-700 mb-3">${q}</div>
                <div class="space-y-2">
            `;

            options.forEach(option => {
                const nextStep = currentStep + 1;
                // data æ ¼å¼æ¨¡ä»¿ LINE Postback: action=next_quiz&step=2&val=+3Culture,+2CultureDepth
                const postbackData = `action=next_quiz&step=${nextStep}&val=${option.val}`;
                
                quizHTML += `
                    <button onclick="handlePostback('${postbackData}')" 
                            class="w-full text-left p-3 bg-gray-50 hover:bg-green-100 border border-green-200 rounded-lg text-sm transition duration-150">
                        ${option.label}
                    </button>
                `;
            });

            quizHTML += `</div>`;
            
            addMessage('quiz', quizHTML, true);
        }
        
        /**
         * æ ¹æ“šç”¨æˆ¶åå¥½å‘é‡å’ŒæŸ¥è©¢ï¼Œå¾çœŸå¯¦æ™¯é»è³‡æ–™åº«ä¸­é¸æ“‡æ™¯é»
         * @param {string} userQuery - ç”¨æˆ¶è¼¸å…¥çš„æŸ¥è©¢ (e.g., "æ–°ç«¹å³¨çœ‰ï¼Œæˆ¶å¤–æ´»å‹•")
         * @param {Object} preferenceVector - åå¥½å‘é‡
         * @returns {Object} åŒ…å«è¦åŠƒçµæœçš„ JSON
         */
        function generateHakkaItinerary(userQuery, preferenceVector) {
            const query = userQuery.toLowerCase();
            // æ‰¾å‡ºåˆ†æ•¸æœ€é«˜çš„åå¥½ä½œç‚ºä¸»é¡Œæ ¸å¿ƒ
            const topPreference = Object.keys(preferenceVector).reduce((a, b) => preferenceVector[a] > preferenceVector[b] ? a : b);

            // 1. ç¯©é¸æ™¯é» (å„ªå…ˆè€ƒæ…®åœ°å€é—œéµå­—)
            let candidates = HAKKA_ATTRACTIONS;
            let regionMatch = '';

            if (query.includes('æ¡ƒåœ’') || query.includes('é¾æ½­') || query.includes('å¤§æºª')) { regionMatch = 'æ¡ƒåœ’'; }
            else if (query.includes('æ–°ç«¹') || query.includes('å³¨çœ‰') || query.includes('åŒ—åŸ”') || query.includes('é—œè¥¿')) { regionMatch = 'æ–°ç«¹'; }
            else if (query.includes('è‹—æ —') || query.includes('å—åº„') || query.includes('ç…æ½­')) { regionMatch = 'è‹—æ —'; }
            else if (query.includes('å°ä¸­') || query.includes('æ±å‹¢') || query.includes('çŸ³å²¡')) { regionMatch = 'å°ä¸­'; }

            if (regionMatch) {
                candidates = candidates.filter(att => att.region === regionMatch);
            }
            
            // 2. é¸æ“‡æœ€ä½³æ™¯é» (æ ¹æ“šæœ€é«˜åå¥½)
            // æ‰¾å‡ºæœ€åŒ¹é… topPreference çš„æ™¯é»ï¼Œè‹¥ç„¡åœ°å€é™å®šå‰‡å¾æ‰€æœ‰æ™¯é»ä¸­æ‰¾
            let bestAttraction = candidates.sort((a, b) => {
                // è¨ˆç®—æ™¯é»èˆ‡ç”¨æˆ¶æœ€é«˜åå¥½ç¶­åº¦çš„åŒ¹é…åˆ†æ•¸
                const scoreA = a.theme.includes(topPreference) ? 1 : 0;
                const scoreB = b.theme.includes(topPreference) ? 1 : 0;
                return scoreB - scoreA; // é™å†ªæ’åˆ— (åˆ†æ•¸é«˜çš„å„ªå…ˆ)
            })[0] || candidates[Math.floor(Math.random() * candidates.length)]; // è‹¥ç„¡åŒ¹é…ï¼Œéš¨æ©Ÿé¸ä¸€å€‹

            // 3. åˆ¤æ–·ä¸»é¡Œèˆ‡æ­¥èª¿
            const C = preferenceVector['Culture'];
            const O = preferenceVector['Outdoor'];
            const P = preferenceVector['Pace'];
            const F = preferenceVector['Family'];

            let title = `ã€å°ä¸‰ç·šå®¢è£½åŒ–æ¨è–¦ã€‘${bestAttraction.region}ä¸»é¡Œä¹‹æ—…`;
            let theme = bestAttraction.theme.includes('Outdoor') ? "æˆ¶å¤–è‡ªç„¶æ¢ç´¢" : "å®¤å…§æ–‡åŒ–æ…¢æ´»";
            
            if (C > O && C > 5) { theme = "æ·±åº¦æ–‡å²èˆ‡å®¢å®¶é¢¨æƒ…"; }
            else if (O > C && O > 5) { theme = "å±±æ—æ­¥é“èˆ‡è‡ªç„¶ç™‚ç™’"; }
            if (P > 0) { theme += ", æ…¢æ´»æ­¥èª¿"; } else { theme += ", ç·Šæ¹Šè¡Œç¨‹"; }
            if (F > 5) { theme += ", è¦ªå­/ç„¡éšœç¤™å‹å–„"; }


            return {
                "title": title,
                "theme": theme,
                "recommendation_reason": `æ ¹æ“šæ‚¨çš„ã€${theme}ã€‘å‚¾å‘ï¼Œå°é˜¿å®¢ç‚ºæ‚¨ç²¾é¸äº†å°ä¸‰ç·šæœ€åˆé©çš„æ™¯é»ã€‚æœ¬æ¬¡è¡Œç¨‹åœ°é»ã€Œ${bestAttraction.name}ã€ä½æ–¼${bestAttraction.region}ï¼Œå®Œå…¨ç¬¦åˆæ‚¨åœ¨å•å·ä¸­å±•ç¾å‡ºçš„æ ¸å¿ƒåå¥½ã€‚`,
                "itinerary": [
                    {
                        "time": "10:00 - 12:00",
                        "name": bestAttraction.name,
                        "description": bestAttraction.description,
                        "location_url": bestAttraction.map_url
                    },
                    {
                        "time": "12:00 - 13:30",
                        "name": "åœ¨åœ°å®¢å®¶åˆé¤æ¨è–¦",
                        "description": P > 0 ? "æ…¢é£Ÿå®¢åº„ï¼šæ¨è–¦å°‹æ‰¾å··å¼„å…§çš„è€å­—è™Ÿå®¢å®¶å°é¤¨ï¼Œäº«å—æ…¢é£Ÿæ–‡åŒ–ã€‚" : "æ•ˆç‡åˆé¤ï¼šåœ¨è€è¡—å‘¨é‚Šå¿«é€Ÿå“åšåœ¨åœ°ç²„æ¢æˆ–è‚‰åœ“ã€‚",
                        "location_url": bestAttraction.map_url 
                    },
                    {
                        "time": "14:00 - 16:30",
                        "name": "å‘¨é‚Šç‰¹è‰²é«”é©—",
                        "description": O > C ? "æ¨è–¦å‘¨é‚Šçš„ä½ç¢³è‡ªè¡Œè»Šé“æˆ–ç”Ÿæ…‹è¾²å ´é«”é©—ã€‚" : "æ¨è–¦åœ¨å®—ç¥ æˆ–æ­·å²è¡—å€åƒèˆ‡å®¢å®¶DIYï¼ˆå¦‚æ“‚èŒ¶ã€è—æŸ“ï¼‰ã€‚",
                        "location_url": bestAttraction.map_url 
                    }
                ],
                "carbon_footprint_estimate": `${(12 - preferenceVector['LowCarbon']).toFixed(1)} kg CO2e`
            };
        }


        // --- è¡Œç¨‹å¡ç‰‡ UI å‡½æ•¸ (ä¸è®Š) ---
        function createItineraryCard(itineraryJson) {
            let itineraryItemsHTML = '';
            itineraryJson.itinerary.forEach(item => {
                itineraryItemsHTML += `
                    <div class="py-2 border-b border-gray-100 last:border-b-0">
                        <div class="flex items-center text-sm font-semibold text-gray-700 mb-1">
                            <i data-lucide="clock" class="w-4 h-4 mr-2 text-green-600"></i>
                            ${item.time} - ${item.name}
                        </div>
                        <p class="text-xs text-gray-500 pl-6">${item.description}</p>
                        <a href="${item.location_url}" target="_blank" class="text-xs text-indigo-500 hover:text-indigo-700 transition duration-150 pl-6 underline flex items-center mt-1">
                            <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> Google åœ°åœ–
                        </a>
                    </div>
                `;
            });
            
            const cardHTML = `
                <div class="flex-card w-full max-w-sm text-gray-800">
                    <div class="p-3 bg-green-700 text-white rounded-t-xl">
                        <div class="text-xl font-bold">${itineraryJson.title}</div>
                        <div class="text-xs opacity-80 mt-1">ä¸»é¡Œ: ${itineraryJson.theme}</div>
                    </div>
                    
                    <div class="p-4 space-y-3">
                        <div class="border-b pb-3">
                            <div class="text-xs font-semibold text-green-700 mb-1">å°é˜¿å®¢æ¨è–¦ç†ç”±:</div>
                            <p class="text-sm">${itineraryJson.recommendation_reason}</p>
                        </div>
                        
                        <div class="text-sm font-bold mt-3">ã€è©³ç´°è¡Œç¨‹ - å°ä¸‰ç·šå®¢åº„ã€‘</div>
                        ${itineraryItemsHTML}

                        <div class="text-right text-xs text-indigo-500 font-medium pt-2">
                            ä½ç¢³ä¼°ç®—ï¼ˆåƒè€ƒå€¼ï¼‰: ${itineraryJson.carbon_footprint_estimate}
                        </div>
                    </div>

                    <div class="flex p-3 border-t bg-gray-50">
                        <button onclick="handlePostback('action=get_rain_plan')" class="flex-1 text-center py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-semibold rounded-lg transition duration-200">
                            <i data-lucide="umbrella" class="w-4 h-4 inline-block mr-1"></i> é›¨å¤©å‚™æ¡ˆ
                        </button>
                    </div>
                </div>
            `;
            addMessage('bot', cardHTML, true);
        }
        
        // --- åœ–åƒç”Ÿæˆèˆ‡éŒ¯èª¤è™•ç† ---

        async function callImageGenerationApi(prompt) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            
            const payload = { 
                instances: [{ prompt: prompt }], 
                parameters: { 
                    "sampleCount": 1,
                    "outputMimeType": "image/png",
                    "aspectRatio": "1:1" // é©åˆèŠå¤©è¦–çª—çš„æ¯”ä¾‹
                } 
            };

            let attempts = 0;
            const maxAttempts = 3;

            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                        return result.predictions[0].bytesBase64Encoded;
                    } else {
                        throw new Error("Image API returned no valid data.");
                    }

                } catch (error) {
                    attempts++;
                    if (attempts < maxAttempts) {
                        // Exponential backoff
                        const delay = Math.pow(2, attempts) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        console.error("Failed to call Image Generation API after multiple retries:", error);
                        return null;
                    }
                }
            }
        }


        async function generatePersonalityImageAndMessage(finalPrefs) {
            const score = (dim) => finalPrefs[dim] || 0;
            const C = score('Culture');
            const O = score('Outdoor');
            const I = score('Indoor');
            const P = score('Pace');
            const F = score('Family');
            const A = score('Accessibility');

            let personalityDescription = "æ‚¨çš„æ ¸å¿ƒæ—…éŠäººæ ¼æ˜¯ï¼š**";
            let itineraryFocus = "å› æ­¤ï¼Œå°é˜¿å®¢å»ºè­°æ‚¨å˜—è©¦ï¼š";
            let imagePromptEnglish = ""; // For the AI Image Generator
            let mainPersonality = ""; // For UI display

            // 1. æ ¸å¿ƒäººæ ¼åˆ¤æ–·
            if (O > C + 1 && O > I + 1 && O > 3) {
                mainPersonality = "å¤©ç”Ÿçš„æ¢éšªå®¶";
                personalityDescription += "å¤©ç”Ÿçš„æ¢éšªå®¶ (The Explorer) ğŸï¸**";
                itineraryFocus += " **å±±æ—æ­¥é“èˆ‡è‡ªç„¶ç™‚ç™’** çš„æˆ¶å¤–ä¸»é¡Œè¡Œç¨‹";
                imagePromptEnglish = "A person hiking alone on a lush green mountain path, sun shining, feeling adventurous, watercolor style, Hakka region of Taiwan.";
            } else if (C > O + 1 && C > I + 1 && C > 3) {
                mainPersonality = "æ·±åº¦æ–‡å²æ¢ç´¢è€…";
                personalityDescription += "æ·±åº¦æ–‡å²æ¢ç´¢è€… (The Historian) ğŸ“š**";
                itineraryFocus += " **æ·±åº¦å®¢å®¶æ–‡åŒ–èˆ‡æ­·å²å°è¦½** çš„æ–‡å²ä¸»é¡Œä¹‹æ—…";
                imagePromptEnglish = "A person studying an ancient Hakka traditional architecture in Taiwan, with a notebook, quiet and focused, cinematic light, digital painting.";
            } else if (I > O + 1 && I > C + 1 && I > 3) {
                mainPersonality = "ç²¾ç·»å…§æ–‚é‘‘è³å®¶";
                personalityDescription += "ç²¾ç·»å…§æ–‚é‘‘è³å®¶ (The Connoisseur) â˜•ï¸**";
                itineraryFocus += " **å®¤å…§æ‰‹ä½œé«”é©—èˆ‡å®¢åº„æ…¢é£Ÿ** çš„æ‚ é–’ä¸»é¡Œ";
                imagePromptEnglish = "A cozy indoor scene of a person enjoying a cup of traditional Hakka Lei Cha (ground tea), soft ambient light, focus on the details, warm colors, photograph style.";
            } else {
                mainPersonality = "å‡è¡¡å¤šå…ƒæ—…äºº";
                personalityDescription += "å‡è¡¡å¤šå…ƒæ—…äºº (The Balancer) ğŸŒ±**";
                itineraryFocus += " çµåˆ **è€è¡—å·¡ç¦®èˆ‡è¿‘éƒŠå–®è»Š** çš„å¹³è¡¡è¡Œç¨‹";
                imagePromptEnglish = "A scenic shot of a person cycling near a traditional Hakka old street and green rice fields in Taiwan, sunny day, vibrant, photorealistic.";
            }
            
            personalityDescription += "ã€‚";
            itineraryFocus += "ã€‚";
            
            // 2. æ­¥èª¿èˆ‡é¢¨éšªåˆ¤æ–·
            let paceDescription = "";
            if (P > 2) {
                paceDescription = "æ‚¨çš„æ­¥èª¿ä¸­å¸¶è‘—**æ‚ ç„¶çš„å¾å®¹**ï¼Œäº«å—æ…¢ä¸‹ä¾†çš„æ·±åº¦é«”é©—ã€‚";
            } else if (P < -2) {
                paceDescription = "æ‚¨è¿½æ±‚**é«˜æ•ˆã€ç·Šæ¹Šä¸”ç›®æ¨™æ˜ç¢º**çš„è¡Œç¨‹ï¼Œåå¥½ä¸€æ¬¡èµ°è¨ªå¤šå€‹æ™¯é»ã€‚";
            }
            
            // 3. ç‰¹æ®Šè€ƒé‡
            let specialConsideration = "";
            if (F > 3 || A > 3) {
                specialConsideration = "æ­¤å¤–ï¼Œæ‚¨æ›´çœ‹é‡æ—…ç¨‹çš„**å…±äº«èˆ‡åœ“æ»¿**ï¼Œæœƒå„ªå…ˆè€ƒæ…®æ‰€æœ‰åŒè¡Œè€…çš„èˆ’é©èˆ‡ä¾¿åˆ©æ€§ (è¦ªå­/ç„¡éšœç¤™)ã€‚";
            }

            // çµ„åˆæœ€çµ‚è¨Šæ¯ (è¼‰å…¥å‰éƒ¨åˆ†)
            let finalMessageContent = `æ­å–œæ‚¨ï¼æ‚¨å·²å®Œæˆ **10 é¡Œå®¢åº„æ—…éŠå•å·**ã€‚<br><br>`;
            finalMessageContent += personalityDescription + `<br>`;
            if (paceDescription) {
                finalMessageContent += paceDescription + `<br>`;
            }
            if (specialConsideration) {
                finalMessageContent += specialConsideration + `<br>`;
            }
            finalMessageContent += `<br>å°é˜¿å®¢ç‚ºæ‚¨æç¹ªçš„æ—…éŠå¿ƒå¢ƒåœ–ï¼š<br>`;

            // Add loading message for the image
            const loadingMessageHtml = `
                ${finalMessageContent}
                <div id="image-loading-spinner" class="mt-4 p-4 text-center bg-gray-100 rounded-lg text-gray-500">
                    <i data-lucide="loader" class="w-6 h-6 inline-block animate-spin mr-2 text-green-700"></i>
                    æ­£åœ¨ç‚ºæ‚¨çš„ã€${mainPersonality}ã€‘äººæ ¼ç”Ÿæˆå°ˆå±¬æ„å¢ƒåœ–... (ç´„éœ€ 10-15 ç§’)
                </div>
            `;
            
            // Add the loading message to the chat and get its div
            const messageId = `msg-${Date.now()}`;
            // Add the loading message structure using a unique ID
            const botMessageDiv = addMessage('bot', `<div id="${messageId}">${loadingMessageHtml}</div>`);
            const messageContentWrapper = botMessageDiv.parentElement; 
            
            let imageUrl = null;
            try {
                const base64Data = await callImageGenerationApi(imagePromptEnglish);
                if (base64Data) {
                    imageUrl = `data:image/png;base64,${base64Data}`;
                }
            } catch (e) {
                console.error("Image generation failed:", e);
            }

            // 4. æ›¿æ›/æ›´æ–°è¨Šæ¯å…§å®¹
            let imageHtml = '';
            if (imageUrl) {
                imageHtml = `<div class="mt-4 w-full h-auto max-w-full rounded-lg shadow-xl overflow-hidden">
                                <img src="${imageUrl}" alt="AI æ„å¢ƒåœ–: ${mainPersonality}" class="w-full h-auto object-cover">
                            </div>`;
            } else {
                imageHtml = `<div class="mt-4 p-4 text-center bg-red-100 rounded-lg text-red-700 text-sm">
                                æ„å¢ƒåœ–ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚
                            </div>`;
            }

            // Final message content with image
            let finalMessageWithImage = finalMessageContent + imageHtml;
            finalMessageWithImage += `<br>${itineraryFocus}<br><br>ç¾åœ¨è«‹ç›´æ¥è¼¸å…¥æ‚¨çš„æ—…éŠéœ€æ±‚ (ä¾‹å¦‚ï¼šã€æ–°ç«¹å³¨çœ‰ï¼Œæˆ¶å¤–æ´»å‹•ã€ æˆ– ã€æƒ³å»è‹—æ —å—åº„ï¼Œæ…¢æ´»ä¸»é¡Œã€)ï¼Œå°é˜¿å®¢æœƒç«‹å³ç‚ºæ‚¨è¦åŠƒ**æœ€å®¢è£½åŒ–**çš„å°ä¸‰ç·šå®¢åº„è¡Œç¨‹ï¼`;

            // Update the content of the existing message wrapper
            if (messageContentWrapper) {
                messageContentWrapper.innerHTML = `<i data-lucide="bot" class="w-4 h-4 mr-1 inline-block text-green-700"></i> ${finalMessageWithImage}`;
                lucide.createIcons(); // Re-render icons after content change
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }


        // --- äº‹ä»¶è™•ç† ---

        async function handlePostback(data) {
            const params = new URLSearchParams(data);
            const action = params.get('action');
            const userState = getUserState(DEFAULT_USER_ID);

            if (action === 'next_quiz') {
                const nextStep = parseInt(params.get('step'));
                const valString = params.get('val');
                
                // 1. ç´¯ç©æ¬Šé‡
                updatePreferenceVector(DEFAULT_USER_ID, valString);
                userState.quiz_step = nextStep - 1; 

                if (nextStep <= TOTAL_QUIZ_STEPS) {
                    // 2. ç™¼é€ä¸‹ä¸€é¡Œ
                    const quizData = QUIZ_QUESTIONS[nextStep];
                    createQuizMessage(quizData, nextStep);
                    userState.quiz_step = nextStep;
                } else {
                    // 3. æ¸¬é©—çµæŸ (è¼¸å‡ºæµªæ¼«åŒ–çš„ç¸½çµ + åœ–åƒç”Ÿæˆ)
                    userState.quiz_step = TOTAL_QUIZ_STEPS;
                    const finalPrefs = userState.preferences;
                    
                    await generatePersonalityImageAndMessage(finalPrefs);
                }

            } else if (action === 'get_rain_plan') {
                // æ¨¡æ“¬é›¨å¤©å‚™æ¡ˆçš„äº’å‹•
                addMessage('bot', 'å¥½çš„ï¼Œå°é˜¿å®¢æ”¶åˆ°é›¨å¤©å‚™æ¡ˆè«‹æ±‚ï¼è‹¥é‡ä¸‹é›¨ï¼Œå»ºè­°å°‡æˆ¶å¤–æ­¥é“æ”¹ç‚ºåƒè§€é™„è¿‘çš„**å®¢å®¶æ–‡åŒ–æœƒé¤¨**æˆ–**å®¤å…§DIYé«”é©—**ï¼ˆå¦‚ç±³é£Ÿè£½ä½œï¼‰ã€‚');
            }
        }

        /**
         * è™•ç†ç”¨æˆ¶åœ¨ Rich Menu æˆ–æ–‡å­—è¼¸å…¥æ¡†çš„æŒ‡ä»¤
         * @param {string} text - ç”¨æˆ¶è¼¸å…¥æˆ–é»æ“Šçš„æŒ‡ä»¤æ–‡å­—
         */
        function handleMessage(text) {
            const userState = getUserState(DEFAULT_USER_ID);
            
            // æ¨¡æ“¬ç”¨æˆ¶ç™¼é€è¨Šæ¯
            addMessage('user', text);

            const isRestart = text === "é‡æ–°æ¸¬é©—" || text === "é–‹å§‹æ¸¬é©—";
            
            // --- ä¿®æ­£ BUG: ç¢ºä¿é»æ“Š 'é‡æ–°æ¸¬é©—' æ™‚èƒ½æ­£ç¢ºå•Ÿå‹•æ¸¬é©— ---
            
            if (isRestart) {
                // 1. é‡è¨­ç‹€æ…‹
                userState.quiz_step = 0;
                userState.preferences = { ...PREFERENCE_DIMENSIONS };
            }

            // Check if quiz needs to be started (step is 0)
            if (userState.quiz_step === 0) {
                // è®“ç”¨æˆ¶çŸ¥é“éœ€è¦å…ˆæ¸¬é©—
                if (text === "æˆ‘æƒ³è¦åŠƒè¡Œç¨‹" || (text.includes('è¦åŠƒè¡Œç¨‹') && !isRestart)) {
                    addMessage('bot', "å°é˜¿å®¢äº†è§£æ‚¨çš„éœ€æ±‚ï¼è«‹å…ˆé»æ“Šã€Œé–‹å§‹æ¸¬é©—ã€ï¼Œå®Œæˆ **10 é¡Œå®¢åº„æ—…éŠå•å·**ï¼Œä»¥ç²å¾—æœ€å®¢è£½åŒ–çš„è¡Œç¨‹å»ºè­°ã€‚");
                    return; // æç¤ºå¾Œä¸ç«‹å³å•Ÿå‹•ï¼Œè®“ç”¨æˆ¶è‡ªè¡Œé»æ“Š
                } else if (!isRestart && !text.includes('è¦åŠƒè¡Œç¨‹') && !text.includes('è¡Œç¨‹')) {
                    // å¦‚æœç”¨æˆ¶è¼¸å…¥éš¨æ„æ–‡å­—ï¼Œæç¤ºä»–å€‘é–‹å§‹æ¸¬é©—
                    addMessage('bot', "è«‹å…ˆé»æ“Šã€Œé–‹å§‹æ¸¬é©—ã€æŒ‰éˆ•ï¼Œå•Ÿå‹•å®¢è£½åŒ–æµç¨‹ã€‚");
                    return;
                }
                
                // 2. å•Ÿå‹•æ¸¬é©— (Q1)
                const quizData = QUIZ_QUESTIONS[1];
                createQuizMessage(quizData, 1);
                userState.quiz_step = 1;
                return;
            }
            // --- ä¿®æ­£çµæŸ ---


            // è™•ç†è¡Œç¨‹è¦åŠƒéœ€æ±‚ (éœ€è¦å…ˆå®Œæˆæ¸¬é©—)
            if (userState.quiz_step >= TOTAL_QUIZ_STEPS || text.includes('è¦åŠƒè¡Œç¨‹') || text.includes('è¡Œç¨‹')) {
                try {
                    addMessage('bot', `<i data-lucide="loader" class="w-4 h-4 mr-1 inline-block animate-spin text-green-700"></i> å°é˜¿å®¢æ­£åœ¨æ ¹æ“šæ‚¨çš„åå¥½å’Œã€Œ${text}ã€è¦åŠƒ**å°ä¸‰ç·šå®¢åº„è¡Œç¨‹**ä¸­... è«‹ç¨å€™ã€‚`);
                    
                    // æ¨¡æ“¬ 1.5 ç§’å»¶é²ä¾†æ¨¡æ“¬ LLM å‘¼å«æ™‚é–“
                    setTimeout(() => {
                        const preferenceVector = userState.preferences;
                        // ä½¿ç”¨æ–°çš„ LLM å‡½æ•¸ï¼Œè©²å‡½æ•¸æœƒçµåˆçœŸå¯¦æ™¯é»è³‡æ–™åº«é€²è¡Œè¦åŠƒ
                        const itineraryJson = generateHakkaItinerary(text, preferenceVector);
                        createItineraryCard(itineraryJson);
                    }, 1500);

                } catch (e) {
                    addMessage('bot', `å°ä¸èµ·ï¼Œè¡Œç¨‹è¦åŠƒç³»çµ±å‡ºç¾éŒ¯èª¤: ${e.message}`);
                    console.error("è¡Œç¨‹è¦åŠƒéŒ¯èª¤:", e);
                }
            } else if (userState.quiz_step > 0 && userState.quiz_step < TOTAL_QUIZ_STEPS) {
                // ç”¨æˆ¶æ­£åœ¨æ¸¬é©—ä¸­ï¼Œä½†è¼¸å…¥äº†å…¶ä»–æ–‡å­—
                 addMessage('bot', `è«‹å…ˆå›ç­”ç›®å‰çš„ç¬¬ ${userState.quiz_step} é¡Œï¼Œæ‰èƒ½ç¹¼çºŒå–”ï¼`);
            }
        }

        function sendMessage() {
            const text = userInput.value.trim();
            if (text) {
                handleMessage(text);
                userInput.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
            }
        }

        // --- ç¶²é è¼‰å…¥åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹å•å€™èª
            addMessage('bot', `æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„å®¢é€” AI æ—…ä¼´ â€” **å°é˜¿å®¢**ï¼<br>
                                æˆ‘å€‘å°‡æ¢ç´¢å°ä¸‰ç·šï¼ˆæµªæ¼«å®¢åº„å¤§é“ï¼‰çš„ç¨ç‰¹é­…åŠ›ã€‚<br>
                                ç‚ºäº†çµ¦æ‚¨æœ€è²¼å¿ƒçš„è¡Œç¨‹å»ºè­°ï¼Œè«‹å…ˆå®Œæˆ **10 é¡Œå®¢åº„æ—…éŠå•å·**ã€‚`);
            
            // å»¶é²å¾Œé¡¯ç¤ºé–‹å§‹æŒ‰éˆ• (æ¨¡æ“¬ Rich Menu äº’å‹•)
            setTimeout(() => {
                const quizStartButton = `
                    <div class="w-full text-center">
                        <button onclick="handleMessage('é‡æ–°æ¸¬é©—')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200 shadow-md">
                            é»æˆ‘é–‹å§‹å•å·ï¼
                        </button>
                    </div>
                `;
                addMessage('bot', quizStartButton, true);
            }, 500);
        });

    </script>
</body>
</html>
